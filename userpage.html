<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <title>User HomePage</title>

  <script src="js/vendor/jquery-3.1.0.js"></script>
  <script src="js/vendor/bootstrap.min.js"></script>
  <script src="js/vendor/aws-cognito-sdk.min.js"></script>
  <script src="js/vendor/amazon-cognito-identity.min.js"></script>
  <script src="js/config.js"></script>
  <script src="js/cognito-auth.js"></script>
  <style>
    body,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-family: "Raleway", Arial, Helvetica, sans-serif
    }

    .styled-table thead tr {
      background-color: #009879;
      color: #ffffff;
      text-align: center;
    }

    .styled-table th,
    .styled-table td {
      padding: 1px 15px;
    }

    .styled-table tbody tr {
      border-bottom: 1px solid #dddddd;
    }

    .styled-table tbody tr:nth-of-type(even) {
      background-color: #f3f3f3;
    }

    .styled-table tbody tr:last-of-type {
      border-bottom: 2px solid #009879;
    }

    .styled-table tbody tr.active-row {
      font-weight: bold;
      color: #009879;
    }

    .bgimg {
      background-image: url('https://blog.olx.com.lb/wp-content/uploads/2020/07/Smart-Home-Background.jpg');

      /* Full height */
      height: 1000px;

      /* Center and scale the image nicely */
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
    }
  </style>
</head>

<body class="bgimg w3-center">


  <div class="w3-container w3-margin-top w3-center w3-white" id="Panel">
    <h3>User HomePage</h3>
    <div class="w3-right">
      <a href="index.html" onClick="myCognitoAuth.signOut();" class="nav-link">Sign Out</a>
    </div>
  </div>

  <div class="content" id="home">
    <div class="textBox">
      <p></p>
    </div>
    <div class="imgBox">
      <p></p>
    </div>
  </div>




  <!-- Booking a hotel  -->


  <section class="book" id="searchhotel">
    <div class="container flex">
      <div class="input grid">

      </div>
      <button class="search" onClick="myOnClickFn()">
        <font size="5">Search</font>
      </button>

<div class="w3-row-padding w3-padding-16">
  <div class="w3-margin-bottom">
    <div class="w3-container w3-white">
      <h3>List of the files uploaded by all users</h3>
      <button type="button" onclick="callHotelGuestListAPI2()">Get uploaded file List</button>
      <p class="styled-table" id="guestList"> </p>
    </div>
  </div>
  
      <script>
        $('#searchhotel').ready(function () {
          var d = new Date(); //today 
          $('#input_checkindate').val(d.toISOString().split("T")[0]);
          d.setDate(d.getDate() + 1); //tomorrow
          $('#input_checkoutdate').val(d.toISOString().split("T")[0]);
        });
        function myOnClickFn() {
          let roomcount = $('#input_roomcount').val();
          let checkin_date = $('#input_checkindate').val();
          let checkout_date = $('#input_checkoutdate').val();
          let location = $('#input_city').val();
          $('#hotellist').empty();
          $('#hotellist').append("<p> Looking up for information ... </p>");
          searchHotelbyLocation(location, checkin_date, checkout_date, roomcount);
          //  document.location.href = "gethotelbooking_test.html";
        } 
      </script>

    </div>
    </div>
  </section>
  <section id="searchhotelresult">
    <div style="height:440; position:relative; overflow:auto" id="hotellist">

    </div>

  </section>

  <script>
    var username;

    function getUsername() {
      Strikers.authUser
        .then(e => { username = e.username; })
        .catch(err => {
          alert("not login " + err);
          window.location.href = '/login.html';
        });
      return username;//getCookie('username');
    }

    $(document).ready(function () {
      getUsername();
    })

    var callBookingHotelAPI = async (hotelId) => {  //Start of boooking hotel API
      var myHeaders = new Headers();
      myHeaders.append("Content-Type", "application/json");
      var username = await getUsername();
      // var roomcount = $('#input_roomcount').val();
      var checkin_date = $('#input_checkindate').val();
      var checkout_date = $('#input_checkoutdate').val();
      console.log(username);
      var hotelObj = findHotel(hotelId);
      var options = getOptions(hotelObj);
      var raw = JSON.stringify({
        "username": username,
        "hotel": hotelObj,
        "checkin_date": checkin_date,
        "checkout_date": checkout_date,
        "options": options
      });
      var requestOptions = {
        method: 'POST',
        headers: myHeaders,
        body: raw,
        redirect: 'follow'
      };
      const res = await fetch(_config.api.invokeUrl + "/booking", requestOptions);
      const json = await res.json();
      console.log(json);
      if (json.statusCode == "200") {
        alert(hotelObj.name + " booked");
      } else {
        alert("Sorry! Cannot book " + hotelObj.name + " at the momment");
      }
      // const body = json['guestList'];
      // const customer_len = Object.keys(body).length;

      // var col = [];
      // for (let i = 0; i < customer_len; i++) {
      //   for (var key in body[i]) {
      //     if (col.indexOf(key) === -1) {
      //       col.push(key);
      //     }
      //   }
      // }

      // var table = document.createElement("table");

      // var tr = table.insertRow(-1);                   // TABLE ROW.

      // for (var i = 0; i < col.length; i++) {
      //   var th = document.createElement("th");      // TABLE HEADER.
      //   th.innerHTML = col[i];
      //   tr.appendChild(th);
      // }

      // for (var i = 0; i < customer_len; i++) {

      //   tr = table.insertRow(-1);

      //   for (var j = 0; j < col.length; j++) {
      //     var tabCell = tr.insertCell(-1);
      //     tabCell.innerHTML = body[i][col[j]];
      //   }
      // }

      // var divContainer = document.getElementById("BookingReservation");
      // divContainer.innerHTML = "";
      // divContainer.appendChild(table);
    }


  </script>


  <div align="center" class="book">
    <button class="search" onClick="myBookingReservationLoad()">
      <font size=5>See My Reservation</font>
    </button>
  </div>

  <section id="myBookingReservation">
    <div style="height:440; position:relative; overflow:auto" id="BookingReservation">

    </div>

  </section>

  <!-- getBookingReservation & Cancelling a hotel section -->
  <script>

    function myBookingReservationLoad() {
      $('#BookingReservation').empty();
      $('#BookingReservation').append("<p> Loading information ... </p>");
      callGetBookingbyUser();
    }

    var callGetBookingbyUser = async () => {  //Start of get boooking reservation API
      var myHeaders = new Headers();
      myHeaders.append("Content-Type", "application/json");
      var username = await getUsername();
      // var roomcount = $('#input_roomcount').val(); 
      console.log(username);
      var raw = JSON.stringify({
        "username": username,
      });
      var requestOptions = {
        method: 'POST',
        headers: myHeaders,
        body: raw,
        redirect: 'follow'
      };
      const res = await fetch(_config.api.invokeUrl + "/booking/byuser", requestOptions);
      const json = await res.json();
      console.log(json);
      showReservations(json.body.Items);
    }

    var callCancelHotelAPI = async (cancellingId) => {  //Start of cancelling hotel API
      var myHeaders = new Headers();
      myHeaders.append("Content-Type", "application/json");
      var username = getUsername();
      var raw = JSON.stringify({
        "username": username,
        "bookingId": cancellingId
      });
      var requestOptions = {
        method: 'DELETE',
        headers: myHeaders,
        body: raw,
        redirect: 'follow'
      };
      const res = await fetch(_config.api.invokeUrl + "/booking/byuser", requestOptions);
      const json = await res.json();
      console.log(json);
      if (json.statusCode == "200") {
        alert("Booking(" + cancellingId + ") cancelled successfully")
      } else {
        alert("Sorry! Cancel unsuccessful");
      }

      // const body = json['guestList'];
      // const customer_len = Object.keys(body).length;

      // var col = [];
      // for (let i = 0; i < customer_len; i++) {
      //   for (var key in body[i]) {
      //     if (col.indexOf(key) === -1) {
      //       col.push(key);
      //     }
      //   }
      // }

      // var table = document.createElement("table");

      // var tr = table.insertRow(-1);                   // TABLE ROW.

      // for (var i = 0; i < col.length; i++) {
      //   var th = document.createElement("th");      // TABLE HEADER.
      //   th.innerHTML = col[i];
      //   tr.appendChild(th);
      // }

      // for (var i = 0; i < customer_len; i++) {

      //   tr = table.insertRow(-1);

      //   for (var j = 0; j < col.length; j++) {
      //     var tabCell = tr.insertCell(-1);
      //     tabCell.innerHTML = body[i][col[j]];
      //   }
      // }

      // var divContainer = document.getElementById("CancelReservation");
      // divContainer.innerHTML = "";
      // divContainer.appendChild(table);
    }


  </script>
  <!-- End of API call  -->


  <script>
    var accItem = document.getElementsByClassName('accordionItem');
    var accHD = document.getElementsByClassName('accordionIHeading');

    for (i = 0; i < accHD.length; i++) {
      accHD[i].addEventListener('click', toggleItem, false);
    }

    function toggleItem() {
      var itemClass = this.parentNode.className;
      for (var i = 0; i < accItem.length; i++) {
        accItem[i].className = 'accordionItem close';
      }
      if (itemClass == 'accordionItem close') {
        this.parentNode.className = 'accordionItem open';
      }
    }
  </script>

  <script>
    let slideIndex = 1;
    showSlides(slideIndex);

    // Next/previous controls
    function plusSlides(n) {
      showSlides(slideIndex += n);
    }

    // Thumbnail image controls
    function currentSlide(n) {
      showSlides(slideIndex = n);
    }

    function showSlides(n) {
      let i;
      let slides = document.getElementsByClassName("mySlides");
      let dots = document.getElementsByClassName("dot");
      if (n > slides.length) { slideIndex = 1 }
      if (n < 1) { slideIndex = slides.length }
      for (i = 0; i < slides.length; i++) {
        slides[i].style.display = "none";
      }
      for (i = 0; i < dots.length; i++) {
        dots[i].className = dots[i].className.replace(" active", "");
      }
      slides[slideIndex - 1].style.display = "block";
      dots[slideIndex - 1].className += " active";
    }




  </script>




  <!-- Contact  -->
  <footer>
    <div class="container grid top">
      <div class="box" id="contact">
        <p> </p>

      </div>

      <div class="box">
      </div>
    </div>
  </footer>

</body>

</html>